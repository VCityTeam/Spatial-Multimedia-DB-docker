FROM python:3.6

LABEL maintainer "VCityTeam"
LABEL source.repo "https://github.com/VCityTeam/Spatial-Multimedia-DB-docker.git"

ARG POSTGRES_ORDBMS
ENV POSTGRES_ORDBMS=${POSTGRES_ORDBMS}
ARG POSTGRES_USER
ENV POSTGRES_USER=${POSTGRES_USER}
ARG POSTGRES_PASSWORD
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ARG POSTGRES_HOST
ENV POSTGRES_HOST=${POSTGRES_HOST}
ARG POSTGRES_PORT
ENV POSTGRES_PORT=${POSTGRES_PORT}
ARG POSTGRES_DB_NAME
ENV POSTGRES_DB_NAME=${POSTGRES_DB_NAME}
ARG SPATIAL_MULTIMEDIA_DB_PORT
ENV SPATIAL_MULTIMEDIA_DB_PORT=${SPATIAL_MULTIMEDIA_DB_PORT}
ARG SPATIAL_MULTIMEDIA_DB_ADMIN_EMAIL
ENV SPATIAL_MULTIMEDIA_DB_ADMIN_EMAIL=${SPATIAL_MULTIMEDIA_DB_ADMIN_EMAIL}
ARG SPATIAL_MULTIMEDIA_DB_ADMIN_FIRST_NAME
ENV SPATIAL_MULTIMEDIA_DB_ADMIN_FIRST_NAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_FIRST_NAME}
ARG SPATIAL_MULTIMEDIA_DB_ADMIN_LAST_NAME
ENV SPATIAL_MULTIMEDIA_DB_ADMIN_LAST_NAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_LAST_NAME}
ARG SPATIAL_MULTIMEDIA_DB_ADMIN_PASSWORD
ENV SPATIAL_MULTIMEDIA_DB_ADMIN_PASSWORD=${SPATIAL_MULTIMEDIA_DB_ADMIN_PASSWORD}
ARG SPATIAL_MULTIMEDIA_DB_ADMIN_USERNAME
ENV SPATIAL_MULTIMEDIA_DB_ADMIN_USERNAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_USERNAME}



RUN apt-get update

ARG SMDB=/Spatial-Multimedia-DB

RUN apt-get install -y git

RUN git clone https://github.com/VCityTeam/Spatial-Multimedia-DB.git

WORKDIR /Spatial-Multimedia-DB

RUN echo "POSTGRES_ORDBMS=${POSTGRES_ORDBMS}\nPOSTGRES_USER=${POSTGRES_USER}\nPOSTGRES_PASSWORD=${POSTGRES_PASSWORD}\nPOSTGRES_HOST=${POSTGRES_HOST}\nPOSTGRES_PORT=${POSTGRES_PORT}\nPOSTGRES_DB_NAME=${POSTGRES_DB_NAME}" > .env
RUN echo "\nSPATIAL_MULTIMEDIA_DB_PORT=${SPATIAL_MULTIMEDIA_DB_PORT}\nSPATIAL_MULTIMEDIA_DB_ADMIN_EMAIL=${SPATIAL_MULTIMEDIA_DB_ADMIN_EMAIL}\nSPATIAL_MULTIMEDIA_DB_ADMIN_FIRST_NAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_FIRST_NAME}\nSPATIAL_MULTIMEDIA_DB_ADMIN_LAST_NAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_LAST_NAME}\nSPATIAL_MULTIMEDIA_DB_ADMIN_PASSWORD=${SPATIAL_MULTIMEDIA_DB_ADMIN_PASSWORD}\nSPATIAL_MULTIMEDIA_DB_ADMIN_USERNAME=${SPATIAL_MULTIMEDIA_DB_ADMIN_USERNAME}" >> .env

RUN pip install -r requirements.txt

ENV PYTHONPATH $SMDB

CMD ["python", "api/web_api.py"]